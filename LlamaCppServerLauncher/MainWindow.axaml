<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:res="clr-namespace:LlamaCppServerLauncher.My.Resources"
        xmlns:local="clr-namespace:LlamaCppServerLauncher"
        xmlns:converters="clr-namespace:LlamaCppServerLauncher.Converters"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
        x:Class="LlamaCppServerLauncher.MainWindow"
        x:DataType="local:MainViewModel"
        Title="{x:Static res:Resources.AppTitle}"
        Width="1200" Height="800" FontFamily="Microsoft YaHei UI"
        MinWidth="800" MinHeight="600">

  <Window.Resources>
	<converters:BooleanToBrushConverter x:Key="BooleanToBrushConverter" />
	<converters:BooleanToStatusConverter x:Key="BooleanToStatusConverter" />
  </Window.Resources>

  <Grid RowDefinitions="Auto,*,Auto">
	<!-- Header with Search -->
	<Border Grid.Row="0" Background="#f0f0f0" BorderBrush="#ddd" BorderThickness="0,0,0,1" Padding="10">
	  <Grid ColumnDefinitions="Auto,*,Auto,Auto" Margin="4">
		<!-- Category Filter -->
		<ComboBox Grid.Column="0"
				  x:Name="CategoryComboBox"
				  Margin="4"
				  ItemsSource="{Binding AvailableCategories}"
				  SelectedItem="{Binding SelectedCategory}"
				  PlaceholderText="{x:Static res:Resources.AllCategoriesLabel}"
				  VerticalAlignment="Center"/>

		<!-- Show Modified Only -->
		<CheckBox Grid.Column="3" Margin="2"
				  x:Name="ShowModifiedOnlyCheckBox"
				  Content="{x:Static res:Resources.ShowModifiedOnlyLabel}"
				  IsChecked="{Binding ShowModifiedOnly}"
				  VerticalAlignment="Center"/>

		<!-- Search Box -->
		<TextBox Grid.Column="1" Margin="2"
				 x:Name="SearchTextBox"
				 Watermark="{x:Static res:Resources.SearchWatermark}"
				 Text="{Binding FilterText, Mode=TwoWay}"
				 VerticalAlignment="Center"
				/>

		<!-- Clear Filters Button -->
		<Button Grid.Column="2" Margin="2"
				x:Name="ClearFiltersButton"
				Content="{x:Static res:Resources.ClearFiltersButton}"
				VerticalAlignment="Center"
				Command="{Binding ClearFiltersCommand}"/>

	  </Grid>
	</Border>

	<!-- Main Content Area -->
	<Grid Grid.Row="1" ColumnDefinitions="*,350" Margin="8">
	  <!-- Left Panel - Parameter List (Auto width) -->
	  <Border Grid.Column="0" BorderBrush="#ddd" BorderThickness="1" CornerRadius="4">
		<Grid RowDefinitions="Auto,*">
		  <!-- Parameter List Header -->
		  <Grid Grid.Row="0" Margin="8,8,8,4">
			<Grid.ColumnDefinitions>
			  <ColumnDefinition Width="*"/>
			  <ColumnDefinition Width="Auto"/>
			</Grid.ColumnDefinitions>

			<TextBlock Grid.Column="0"
					   Text="{x:Static res:Resources.ParameterListHeader}"
					   FontWeight="Bold"
					   FontSize="14"/>

			<TextBlock Grid.Column="1"
					   Text="{Binding ParameterCountText}"
					   Foreground="Gray"
					   FontSize="12"
					   VerticalAlignment="Center"/>
		  </Grid>

		  <!-- Parameter List -->
		  <ScrollViewer Grid.Row="1" Margin="8,0,8,8">
			<ItemsRepeater ItemsSource="{Binding FilteredParameters}"
						   ItemTemplate="{StaticResource ParameterItemTemplate}"/>
		  </ScrollViewer>
		</Grid>
	  </Border>

	  <!-- Right Panel - Main Settings (Fixed Width) -->
	  <GridSplitter HorizontalAlignment="Right" Width="4"/>
	  <ScrollViewer Grid.Column="1">
		<StackPanel Margin="8,0,0,0" Spacing="8">

		  <!-- Command Preview -->
		  <Expander Header="{x:Static res:Resources.CommandPreviewTabHeader}" IsExpanded="True" HorizontalAlignment="Stretch">
			<StackPanel Margin="8,4" Spacing="8">
			  <Button x:Name="UpdateCommandPreviewButton"
					  Content="{x:Static res:Resources.UpdateCommandPreviewButton}"
					  HorizontalAlignment="Left"
					  Command="{Binding UpdateCommandPreviewCommand}"/>

			  <TextBox Text="{Binding CommandPreview}"
					   TextWrapping="Wrap"
					   VerticalAlignment="Stretch"
					   MinHeight="152"
					   IsReadOnly="True"
					   FontFamily="Consolas, monospace"
					   Background="#f8f8f8"/>

			  <Button x:Name="CopyCommandButton"
					  Content="{x:Static res:Resources.CopyCommandButton}"
					  HorizontalAlignment="Right"
					  Command="{Binding CopyCommandCommand}"/>
			</StackPanel>
		  </Expander>

		  <!-- Server Output -->
		  <Expander Header="{x:Static res:Resources.ServerOutputHeader}" IsExpanded="True" HorizontalAlignment="Stretch">
			<StackPanel Margin="8,4" Spacing="8">
			  <Button x:Name="ClearOutputButton"
					  Content="{x:Static res:Resources.ClearOutputButton}"
					  HorizontalAlignment="Left"
					  Command="{Binding ClearOutputCommand}"/>
			  
			  <ListBox ItemsSource="{Binding ServerOutput}"
					   Height="200" x:Name="LstServerOutput"
					   FontFamily="Consolas, monospace"
					   Background="#f8f8f8"
					   BorderBrush="#ddd"
					   BorderThickness="1"
					   ScrollViewer.HorizontalScrollBarVisibility="Auto"
					   ScrollViewer.VerticalScrollBarVisibility="Auto">
				<ListBox.ItemTemplate>
				  <DataTemplate>
					<TextBlock Text="{Binding}" 
							   TextWrapping="Wrap"
							   FontSize="11"/>
				  </DataTemplate>
				</ListBox.ItemTemplate>
			  </ListBox>
			</StackPanel>
		  </Expander>

		  <!-- Statistics -->
		  <Expander Header="{x:Static res:Resources.ParameterStatisticsHeader}" IsExpanded="True" HorizontalAlignment="Stretch">
			<StackPanel Margin="8,4" Spacing="4">
			  <Grid ColumnDefinitions="Auto,*">
				<TextBlock Grid.Column="0" Text="{x:Static res:Resources.TotalParametersLabel}" Margin="0,2"/>
				<TextBlock Grid.Column="1" Text="{Binding TotalParameters}" Margin="0,2"/>
			  </Grid>
			  <Grid ColumnDefinitions="Auto,*">
				<TextBlock Grid.Column="0" Text="{x:Static res:Resources.ModifiedParametersLabel}" Margin="0,2"/>
				<TextBlock Grid.Column="1" Text="{Binding ModifiedParameters}" Margin="0,2" Foreground="Green"/>
			  </Grid>
			  <Grid ColumnDefinitions="Auto,*">
				<TextBlock Grid.Column="0" Text="{x:Static res:Resources.DefaultParametersLabel}" Margin="0,2"/>
				<TextBlock Grid.Column="1" Text="{Binding DefaultParameters}" Margin="0,2" Foreground="Gray"/>
			  </Grid>
			</StackPanel>
		  </Expander>
		</StackPanel>
	  </ScrollViewer>
	</Grid>

	<!-- Footer with Controls -->
	<Border Grid.Row="2" Background="#f0f0f0" BorderBrush="#ddd" BorderThickness="0,1,0,0" Padding="10">
	  <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
		<Button x:Name="StartServerButton" Content="{x:Static res:Resources.StartServerButton}"
				Background="#4CAF50" Foreground="White"
				Command="{Binding StartServerCommand}"/>
		<Button x:Name="StopServerButton" Content="{x:Static res:Resources.StopServerButton}"
				Background="#f44336" Foreground="White"
				Command="{Binding StopServerCommand}"/>
		<Button x:Name="OpenBrowserButton" Content="{x:Static res:Resources.OpenBrowserButton}"
				Background="#2196F3" Foreground="White"
				Command="{Binding OpenBrowserCommand}"/>
		<Separator Width="8" Background="Transparent"/>
		<Button x:Name="SaveSettingsButton" Content="{x:Static res:Resources.SaveSettingsButton}"
				Command="{Binding SaveSettingsCommand}"/>
		<Button x:Name="SaveAsSettingsButton" Content="{x:Static res:Resources.SaveAsSettingsButton}"
				Command="{Binding SaveAsSettingsCommand}"/>
		<Button x:Name="OpenSettingsFileButton" Content="{x:Static res:Resources.OpenSettingsFileButton}"
				Command="{Binding OpenSettingsFileCommand}"/>
		<Button x:Name="LoadSettingsButton" Content="{x:Static res:Resources.LoadSettingsButton}"
				Command="{Binding LoadSettingsCommand}"/>
	  </StackPanel>
	</Border>
  </Grid>
</Window>